<div fxLayout="column" fxFill>
    <tc-tibco-cloud-widget-header style="height: 40px;" [icon]="'tcs-capabilities'"
        [headerText]="'New Datasource Configuration'"></tc-tibco-cloud-widget-header>
    <div fxFlex style="padding: 20px;" fxLayout="column">
        <div fxLayout="column" fxFlex>
            <p>Choose the configuration to be used within this datasource:</p>
            <br>
            <!-- New datasource specific -->
            <mat-horizontal-stepper fxFlex fxLayout="column" labelPosition="bottom" [linear]="isLinear" #stepper>
                <!-- Select the datasource type JDBC, CSV, Manual-->
                <mat-step fxFlex fxLayout="column">
                    <ng-template matStepLabel>Datasource selection</ng-template>
                    <div fxFill fxLayout="column" >
                        <mat-form-field>
                            <mat-label>Datasource type</mat-label>
                            <mat-select [(value)]="inputType">
                                <mat-option value="csv">CSV</mat-option>
                                <!-- <mat-option value="JDBC">JDBC</mat-option> -->
                                <mat-option value="json">JSON</mat-option>
                                <mat-option value="None">Manual creation</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <div *ngIf="inputType === 'csv' || inputType === 'json'" fxLayoutGap="10px">
                            <div fxLayout="column">
                                <mat-form-field>
                                    <input matInput placeholder="Analysis Name" [(ngModel)]="analysisName">
                                </mat-form-field>
                                <mat-form-field>
                                    <input matInput placeholder="Analysis Description" [(ngModel)]="analysisDescription">
                                </mat-form-field>
                            </div>
                            <mat-form-field >
                                <input readonly matInput placeholder="Filename" [(ngModel)]="filename">
                            </mat-form-field>
                            <button *ngIf="filename.length == 0" mat-raised-button color="primary" (click)="file.click()">Select
                                file</button>
                            <button *ngIf="filename.length > 0" mat-raised-button color="primary" (click)="file.click()">Change
                                file</button>
                            <input class="tcs-hidden-input" type="file" accept=".{{inputType}}" #file (change)="onFileSelect(file.files)">
                            <mat-checkbox [(ngModel)]="preview">Preview file</mat-checkbox>
                        </div>
                        <!-- <div fxLayout="column" *ngIf="inputType === 'JDBC'">
                            <div fxLayout="row" fxLayoutAlign="space-between stretch">
                                <mat-form-field fxFlex="47">
                                    <input matInput placeholder="Username" [(ngModel)]="jdbcUsername">
                                </mat-form-field>
                                <mat-form-field fxFlex="47">
                                    <input matInput placeholder="Password" [(ngModel)]="jdbcPassword">
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="space-between stretch">
                                <mat-form-field fxFlex="47">
                                    <input matInput placeholder="Hostname" [(ngModel)]="jdbcHostname">
                                </mat-form-field>
                                <mat-form-field fxFlex="47">
                                    <input matInput placeholder="Port" [(ngModel)]="jdbcPort">
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="space-between stretch">
                                <mat-form-field fxFlex="47">
                                    <input matInput placeholder="Database type" [(ngModel)]="jdbcType">
                                </mat-form-field>
                                <mat-form-field fxFlex="47">
                                    <input matInput placeholder="Database name" [(ngModel)]="jdbcDatabaseName">
                                </mat-form-field>
                            </div>
                            <mat-form-field fxFlex="40">
                                <input matInput placeholder="SQL Query" [(ngModel)]="jdbcSQLQuery">
                            </mat-form-field>
                        </div> -->
                        <div fxFlex class="tcs-filler-panel"></div>
                        <div fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="5px" style="min-height: 50px">
                            <button mat-button mat-raised-button color="primary" matStepperNext [disabled]="enabledButtonTab(1)" (click)="moveNextTab(1)">Next</button>
                        </div>
                    </div>
                </mat-step>
                
                <!--  CSV file and preview -->
                <mat-step *ngIf="inputType === 'csv'">
                    <ng-template matStepLabel>CSV Parse options</ng-template>
                    <div fxFill style="height:100%; overflow:auto" fxLayout="column" fxFlex>
                        <div>
                            <mat-accordion>
                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>Parse options</mat-panel-title>
                                        <mat-panel-description>Options for parsing the CSV file</mat-panel-description>
                                    </mat-expansion-panel-header>
                                    <div fxLayout="row" fxLayoutAlign="space-between stretch">
                                        <div fxLayout="column">
                                            <mat-checkbox [(ngModel)]="preview">Preview</mat-checkbox>
                                            <mat-form-field>
                                                <input [disabled]="!preview" matInput="number" placeholder="Number of rows to preview"
                                                    [(ngModel)]="numberRowsForPreview">
                                            </mat-form-field>
                                            <mat-form-field>
                                                <input matInput placeholder="Quote Char" maxlength="2" [(ngModel)]="quoteChar">
                                            </mat-form-field>
                                        </div>
                                        <div fxLayout="column">
                                            <mat-checkbox [(ngModel)]="useFirstRowAsHeader">Use first row as header
                                            </mat-checkbox>
                                            <mat-form-field>
                                                <input matInput placeholder="Column separator" maxlength="1"
                                                    [(ngModel)]="columnSeparator">
                                            </mat-form-field>
                                            <mat-form-field>
                                                <input matInput placeholder="Escape Char" maxlength="2" [(ngModel)]="escapeChar">
                                            </mat-form-field>
                                        </div>
                                        <div fxLayout="column">
                                            <mat-checkbox [(ngModel)]="skipComments">Skip comments in file</mat-checkbox>
                                            <mat-form-field>
                                                <input [disabled]="!skipComments" matInput placeholder="Coments" maxlength="10"
                                                    [(ngModel)]="comments">
                                            </mat-form-field>
                                        </div>
                                        <div fxLayout="column">
                                            <mat-checkbox [(ngModel)]="skipEmptyLines">Skip empty lines</mat-checkbox>
                                            <!-- <mat-form-field>
                                                <input matInput placeholder="Encoding" [(ngModel)]="encoding">
                                            </mat-form-field> -->
                                            <mat-form-field>
                                                <mat-label>Encoding</mat-label>
                                                <mat-select [(value)]="encoding">
                                                    <mat-option value="UTF-8">UTF-8</mat-option>
                                                    <mat-option value="ISO-8859-1">ISO-8859-1</mat-option>
                                                    <mat-option value="Windows-1251">Windows-1251</mat-option>
                                                    <mat-option value="Windows-1252">Windows-1252</mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                    </div>
                                    <mat-action-row fxLayoutGap="10px">
                                        <!-- <button mat-raised-button color="secondary" (click)="refresh()">Rename Columns</button> -->
                                        <button mat-raised-button color="primary" (click)="refreshCSV()">Refresh</button>
                                    </mat-action-row>
                                </mat-expansion-panel>
                            </mat-accordion>
                            <div>
                                <table *ngIf="data" fxFlex mat-table [dataSource]="data" class="mat-elevation-z8">
                                    <ng-container [matColumnDef]="column" *ngFor="let column of displayedColumns">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{column}}
                                        </th>
                                        <td mat-cell *matCellDef="let element"> {{element[column]}} </td>
                                    </ng-container>
                
                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                </table>
                            </div>
                        </div>
                        <div fxFlex class="tcs-filler-panel"></div>
                        <div fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="10px" style="min-height: 50px">
                            <button mat-raised-button matStepperPrevious>Back</button>
                            <button mat-raised-button color="primary" matStepperNext>Next</button>
                        </div>
                    </div>
                </mat-step>

                <!-- JSON file and preview -->
                <mat-step *ngIf="inputType === 'json'">
                    <ng-template matStepLabel>JSON Parse options</ng-template>
                    <div fxFill style="height:100%; overflow:auto" fxLayout="column" fxFlex>
                        <div>
                            <mat-accordion>
                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>Parse options</mat-panel-title>
                                        <mat-panel-description>Options for parsing the CSV file</mat-panel-description>
                                    </mat-expansion-panel-header>
                                    <div fxLayout="row" fxLayoutAlign="space-between stretch">
                                        <div fxLayout="column">
                                            <mat-checkbox [(ngModel)]="preview">Preview</mat-checkbox>
                                            <mat-form-field>
                                                <input [disabled]="!preview" matInput="number" placeholder="Number of rows to preview"
                                                    [(ngModel)]="numberRowsForPreview">
                                            </mat-form-field>
                                            <mat-form-field>
                                                <input matInput placeholder="Quote Char" maxlength="2" [(ngModel)]="quoteChar">
                                            </mat-form-field>
                                        </div>
                                        <div fxLayout="column">
                                            <mat-checkbox [(ngModel)]="useFirstRowAsHeader">Use first row as header
                                            </mat-checkbox>
                                            <mat-form-field>
                                                <input matInput placeholder="Column separator" maxlength="1"
                                                    [(ngModel)]="columnSeparator">
                                            </mat-form-field>
                                            <mat-form-field>
                                                <input matInput placeholder="Escape Char" maxlength="2" [(ngModel)]="escapeChar">
                                            </mat-form-field>
                                        </div>
                                        <div fxLayout="column">
                                            <mat-checkbox [(ngModel)]="skipComments">Skip comments in file</mat-checkbox>
                                            <mat-form-field>
                                                <input [disabled]="!skipComments" matInput placeholder="Coments" maxlength="10"
                                                    [(ngModel)]="comments">
                                            </mat-form-field>
                                        </div>
                                        <div fxLayout="column">
                                            <mat-checkbox [(ngModel)]="skipEmptyLines">Skip empty lines</mat-checkbox>
                                            <!-- <mat-form-field>
                                                                <input matInput placeholder="Encoding" [(ngModel)]="encoding">
                                                            </mat-form-field> -->
                                            <mat-form-field>
                                                <mat-label>Encoding</mat-label>
                                                <mat-select [(value)]="encoding">
                                                    <mat-option value="UTF-8">UTF-8</mat-option>
                                                    <mat-option value="ISO-8859-1">ISO-8859-1</mat-option>
                                                    <mat-option value="Windows-1251">Windows-1251</mat-option>
                                                    <mat-option value="Windows-1252">Windows-1252</mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                    </div>
                                    <mat-action-row fxLayoutGap="10px">
                                        <!-- <button mat-raised-button color="secondary" (click)="refresh()">Rename Columns</button> -->
                                        <button mat-raised-button color="primary" (click)="refreshJSON()">Refresh</button>
                                    </mat-action-row>
                                </mat-expansion-panel>
                            </mat-accordion>
                            <div>
                                <table *ngIf="data" fxFlex mat-table [dataSource]="data" class="mat-elevation-z8">
                                    <ng-container [matColumnDef]="column" *ngFor="let column of displayedColumns">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{column}}
                                        </th>
                                        <td mat-cell *matCellDef="let element"> {{element[column]}} </td>
                                    </ng-container>
                
                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                </table>
                            </div>
                        </div>
                        <div fxFlex class="tcs-filler-panel"></div>
                        <div fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="10px" style="min-height: 50px">
                            <button mat-raised-button matStepperPrevious>Back</button>
                            <button mat-raised-button color="primary" matStepperNext>Next</button>
                        </div>
                    </div>
                </mat-step>

                <!-- Other options -->
                <mat-step *ngIf="inputType === 'csv' || inputType === 'json'">
                    <ng-template matStepLabel>Other options</ng-template>
                    <div fxFill style="height:100%;overflow:auto" fxLayout="column" fxFlex>
                        <div>
                            <div fxLayout="column">
                                <mat-form-field fxFlex="47">
                                    <input matInput placeholder="Date Time Format" [(ngModel)]="dateTimeFormat">
                                </mat-form-field>                
                            </div>
                        </div>
                        <div fxFlex class="tcs-filler-panel"></div>
                        <div fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="10px" style="min-height: 50px">
                            <button mat-raised-button matStepperPrevious>Back</button>
                            <button mat-raised-button color="primary" matStepperNext>Next</button>
                        </div>
                    </div>
                </mat-step>

                <!-- CSV Mapping -->
                <mat-step *ngIf="inputType === 'csv' || inputType === 'json'">
                    <ng-template matStepLabel>Mapping</ng-template>
                    <div fxFill style="height:100%;overflow:auto" fxLayout="column" fxFlex>
                        <div>
                            <!-- <div fxLayout="row">
                                <div fxFlex fxLayout="column" fxLayoutAlign="center center" *ngFor="let element of icons" cdkDrag>
                                    <mat-icon>{{element.icon}}</mat-icon>
                                    <div>{{element.id}}</div>
                                </div>
                            </div> -->
                            <div fxLayout="column">
                                <mat-form-field>
                                    <mat-label>CaseId</mat-label>
                                    <mat-select [(value)]="caseId" required>
                                        <mat-option *ngFor="let column of displayedColumns" [value]="column">{{column}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field>
                                    <mat-label>Activity</mat-label>
                                    <mat-select [(value)]="activity" required>
                                        <mat-option *ngFor="let column of displayedColumns" [value]="column">{{column}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field>
                                    <mat-label>Resources</mat-label>
                                    <mat-select [(value)]="resource" required>
                                        <mat-option *ngFor="let column of displayedColumns" [value]="column">{{column}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field>
                                    <mat-label>Start</mat-label>
                                    <mat-select [(value)]="start" required>
                                        <mat-option *ngFor="let column of displayedColumns" [value]="column">{{column}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field>
                                    <mat-label>End</mat-label>
                                    <mat-select [(value)]="end">
                                        <mat-option *ngFor="let column of displayedColumns" [value]="column">{{column}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field>
                                    <mat-label>Others</mat-label>
                                    <mat-select [(value)]="other" multiple>
                                        <mat-option *ngFor="let column of displayedColumns" [value]="column">{{column}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div fxFlex class="tcs-filler-panel"></div>
                        <div fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="10px" style="min-height: 50px">
                            <button mat-raised-button matStepperPrevious>Back</button>
                            <button mat-raised-button color="primary" (click)="handleSubmit()">Create datasource</button>
                        </div>
                    </div>
                </mat-step>

                <mat-step *ngIf="inputType === 'None'">
                    <ng-template matStepLabel>Create datasource</ng-template>
                    <div style="height:100%" fxLayout="column" fxFlex>
                        <div style="overflow:auto">
                                    <tcla-live-apps-creators fxFlex [sandboxId]="sandboxId" [applicationId]="'2504'" [typeId]="'1'"></tcla-live-apps-creators>
<!-- (caseCreated)="handleCaseCreation($event)" -->
                        </div>
                        <div fxFlex class="tcs-filler-panel"></div>
                        <!-- <div fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="5px" style="min-height: 50px">
                            <button mat-button matStepperPrevious>Back</button>
                            <button mat-button (click)="stepper.reset()">Reset</button>
                            <button [disabled]="filename.length == 0" mat-raised-button color="primary">Create
                                datasource</button>
                        </div> -->
                    </div>
                </mat-step>
            </mat-horizontal-stepper>
            <mat-progress-bar mode="determinate" [value]="uploadProgress"></mat-progress-bar>
        </div>
    </div>
</div>

    <!-- <button mat-raised-button (click)="isLinear = !isLinear" id="toggle-linear">
                        {{!isLinear ? 'Enable linear mode' : 'Disable linear mode'}}
                    </button> -->
    <!--
                    <div cdkScrollable *ngIf="filename.length > 0" fxLayout="column">
                        Preview table
        
                        Icons for drag and drop
                        <div fxLayout="row" >
                            <div fxFlex fxLayout="column" fxLayoutAlign="center center" *ngFor="let element of icons" cdkDrag>
                                <mat-icon>{{element.icon}}</mat-icon>
                                <div>{{element.id}}</div>
                            </div>
                        </div>
                        
                    </div>
                    style="border-width: 1px;border-color:red;border-style: dashed"
            -->
<!-- <div style="border-width: 1px;border-color:green;border-style: dashed" fxFlex class="tcs-filler-panel"></div>
                <div fxLayout="row" fxLayoutAlign="end end" fxLayoutGap="5px" style="min-height: 50px">
                    <button [disabled]="filename.length == 0" mat-raised-button color="primary">Create datasource</button>
                </div> -->



