<div fxFill fxLayout="row" *ngIf="formConfig">
  <div fxFlex class="tcs-form-config-pane">
    <div class="tcs-form-config-header" fxLayout="row" fxLayoutAlign="space-between center">
      <div fxLayoutAlign="start center">
        <mat-icon svgIcon="tcs-config-icon"></mat-icon>
        <div class="tcs-form-config-header-text">Form Preview</div>
      </div>
    </div>
    <div class="tcs-form-config-content">
      <tcfrm-rendered-form *ngIf="selectedProcess" [schema]="schema" [layout]="layout" [data]="data" [options]="options" [formsFramework]="formsFramework" (formSubmit)="saveSampleData($event)" (renderedLayout)="handleRenderedLayout($event)"></tcfrm-rendered-form>
    </div>
  </div>
  <div fxFlex fxLayout="column">
    <div fxFlex class="tcs-form-config-pane" fxLayout="column">
    <div class="tcs-form-config-header" fxLayout="row" fxLayoutAlign="space-between center">
      <div fxLayoutAlign="start center">
        <mat-icon svgIcon="tcs-config-icon"></mat-icon>
        <div class="tcs-form-config-header-text">Form Configuration</div>
      </div>
    </div>
    <div class="tcs-form-config-content">
      <div fxLayout="row">
        <tcla-live-apps-applications fxFlex [formFieldRendering]="true" [sandboxId]="sandbox" [appIds]="appIds" (selection)="handleAppSelection($event)"></tcla-live-apps-applications>
        <tcla-live-apps-processes fxFlex [sandboxId]="sandbox" [appId]="selectedApp?.applicationId" [typeId]="selectedApp?.id" (processClicked)="handleProcessSelection($event)"></tcla-live-apps-processes>
      </div>

      <mat-accordion>
      <mat-expansion-panel [disabled]="!selectedApp">
        <mat-expansion-panel-header>
          <mat-panel-title>Schema</mat-panel-title>
        </mat-expansion-panel-header>
        <div>This is the input schema (form) generated by Live Apps for the selected process. A form is auto generated based on this schema. You cannot edit this schema directly but changing the form in Live Apps Designer will change this schema.</div>
        <div *ngIf="formSchemaJSON"
             ace-editor
             [text]="formSchemaJSON"
             [options]="aceEditorOptions"
             [readOnly]="true"
             [autoUpdateContent]="true"
             style="width:100%; overflow: auto; border: 1px solid black;">
          (loading form schema...)
        </div>
      </mat-expansion-panel>
      <mat-expansion-panel [disabled]="!selectedApp">
        <mat-expansion-panel-header>
          <mat-panel-title>Layout</mat-panel-title>
        </mat-expansion-panel-header>
        <div *ngIf="!formLayoutJSON">
          <span>You can&nbsp;</span>
          <span class="tcs-clickable" (click)="useAutoLayout()">edit</span>
          <span>&nbsp;the generated layout or&nbsp;</span>
          <span class="tcs-clickable" (click)="useBasicLayout()">append</span>
          <span>&nbsp;the automatic layout&nbsp;</span>
          <span>&nbsp;or create a &nbsp;</span>
          <span class="tcs-clickable" (click)="useNewLayout()">new</span>
          <span>&nbsp;custom layout or start with an&nbsp;</span>
          <span class="tcs-clickable" (click)="useExampleLayout()">example</span>
          <span>&nbsp;layout</span>
        </div>
        <div *ngIf="formLayoutJSON">
          <span>Layout uses JSON schema form layout options - refer to 'Form Definitions'&nbsp;</span><span class="tcs-clickable" (click)="openLayoutDocsTab()">here</span><span>&nbsp;for layout options: </span>
        </div>
        <div *ngIf="formLayoutJSON" fxLayoutAlign="row">
          <div
               ace-editor
               [text]="formLayoutJSON"
               [options]="aceEditorOptions"
               [readOnly]="false"
               [autoUpdateContent]="true"
               (textChanged)="updateLayoutJSON($event)"
               style="width:100%; overflow: auto; border: 1px solid black;">
            (loading form layout...)
          </div>
          <mat-icon svgIcon="tcs-close-icon" (click)="dropLayout()" matTooltip="Clear layout" matTooltipShowDelay="1000" matTooltipPosition="below"></mat-icon>
        </div>
      </mat-expansion-panel>
      <mat-expansion-panel #dataPanel [disabled]="!selectedApp">
        <mat-expansion-panel-header>
          <mat-panel-title>Data</mat-panel-title>
        </mat-expansion-panel-header>
        <div *ngIf="!formDataJSON">You can create a sample data set by using the preview form and clicking submit</div>
        <div *ngIf="formDataJSON">Edits to this data will be displayed in the preview</div>
        <div *ngIf="formDataJSON" fxLayoutAlign="row">
          <div
               ace-editor
               [text]="formDataJSON"
               [options]="aceEditorOptions"
               [readOnly]="false"
               [autoUpdateContent]="true"
               (textChanged)="updateDataJSON($event)"
               style="width:100%; overflow: auto; border: 1px solid black;">
          </div>
          <mat-icon svgIcon="tcs-close-icon" (click)="dropData()" matTooltip="Clear data" matTooltipShowDelay="1000" matTooltipPosition="below"></mat-icon>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
    </div>
  </div>
    <div class="tcs-form-config-pane" fxLayout="column" *ngIf="formConfig && formConfig.processFormConfigs">
      <div class="tcs-form-config-content" fxLayout="row">
        <span>Custom Form Config for {{formConfig.processFormConfigs.length}} {{formConfig.processFormConfigs.length === 1 ? 'process' : 'processes'}}</span>
        <div fxFlex fxLayout="column" fxLayoutAlign="end end" style="margin-right: 20px;">
          <button mat-raised-button color="primary" (click)="handleSaveFormConfig()" matTooltip="Save form configuration" matTooltipShowDelay="1000" matTooltipPosition="below">Save Form Configuration</button>
        </div>
      </div>
  </div>
</div>

