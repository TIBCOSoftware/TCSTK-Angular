<div class="tcs-small-pane" fxLayout="column">
  <div fxLayout="column" fxFill>
    <div class="tcs-collaboration-existing-threads" fxLayout="column">
      <div *ngIf="threads && threads.threads.length > 0">
        <div class="tcs-collaboration-detail-box tcs-collaboration-thread" *ngFor="let thread of threads.threads | reverse" fxLayout="column">

          <div class="tcs-thread-box">
            <!-- collaboration threads -->
            <div class="tcs-collaboration-entry">
              <div fxLayout="row" fxLayoutAlign="space-between start">
                <span class="tcs-collaboration-thread-author">{{thread.note.createdByName}}</span>
                <div fxLayoutAlign="row">
                  <span *ngIf="thread.note.modifiedDate > thread.note.createdDate" class="tcs-collaboration-edited">Edited
                  </span>
                  <span class="tcs-collaboration-thread-date">{{thread.note.modifiedDate | durationSince}}</span>
                </div>
              </div>
              <span class="tcs-collaboration-thread-text">{{thread.note.text}}</span>
            </div>
            <div class="tcs-icon-row" fxLayout="row" fxLayoutAlign="space-between center">
              <div class="tcs-collaboration-thread-icon-left">
                <mat-icon class="tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-delete-icon" svgIcon="tcs-collaboration-delete"></mat-icon>
                <mat-icon class="tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-edit-icon" svgIcon="tcs-collaboration-edit"></mat-icon>
              </div>
              <div class="tcs-collaboration-thread-icon-right" fxLayoutAlign="end center" fxLayoutGap="8px">
                <span *ngIf="thread.note.thread.totalCount > 1" class="tcs-collaboration-thread-replies" (click)="toggleReplies(thread)">{{thread.note.thread.totalCount-1}} replies</span>
                <mat-icon (click)="toggleNewReply(thread)" class="tcs-icon tcs-collaboration-reply-icon" svgIcon="tcs-collaboration-reply"></mat-icon>
              </div>
            </div>
          </div>
        <div class="tcs-collaboration-line"></div>
        <!-- replies -->
        <div class="tcs-collaboration-reply-box" *ngIf="thread.showReplies">
          <div fxLayout="column">
            <div *ngIf="thread.showNewReply" class="tcs-collaboration-new-reply" fxLayoutAlign="space-between center">
              <form class="tcs-collaboration-new-thread-form" #newReplyForm{{thread.note.id}}="ngForm" fxFlex>
                <textarea fxFlex class="tcs-collaboration-input" [(ngModel)]="thread.newReply.text" name="thread.newReply.text" md-maxlength="10000" placeholder="New Reply... " rows="2" max-rows="true"></textarea>
              </form>
              <mat-icon class="tcs-icon tcs-collaboration-send-icon" svgIcon="tcs-collaboration-send" (click)="createReply(thread, thread.newReply.text)"></mat-icon>
            </div>
            <div class="tcs-collaboration-line"></div>
          </div>
          <div class="tcs-collaboration-detail-box tcs-collaboration-reply" *ngFor="let reply of thread.thread | reverse" fxLayout="column">
            <div class="tcs-thread-box" fxLayout="row">
              <mat-icon class="tcs-icon tcs-collaboration-reply-item-icon" svgIcon="tcs-collaboration-reply"></mat-icon>
              <div fxLayout="column" class="tcs-collaboration-reply-details">
                <div class="tcs-collaboration-entry">
                  <div fxLayout="row" fxLayoutAlign="space-between start">
                    <span class="tcs-collaboration-thread-author">{{reply.createdByName}}</span>
                    <span class="tcs-collaboration-thread-date">{{reply.modifiedDate | durationSince}}</span>
                  </div>
                  <span class="tcs-collaboration-thread-text">{{reply.text}}</span>
                </div>
                <div class="tcs-icon-row" fxLayout="row" fxLayoutAlign="space-between center">
                  <div class="tcs-collaboration-thread-icon-left">
                    <mat-icon class="tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-delete-icon" svgIcon="tcs-collaboration-delete"></mat-icon>
                    <mat-icon class="tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-edit-icon" svgIcon="tcs-collaboration-edit"></mat-icon>
                  </div>
                </div>
              </div>
            </div>
            <div class="tcs-collaboration-reply-line"></div>
          </div>
        </div>
      </div>
      </div>
    </div>
    <div class="tcs-collaboration-new-thread" fxLayout="row" fxLayoutAlign="space-between center">
      <form class="tcs-collaboration-new-thread-form" #newThreadForm="ngForm" fxFlex>
        <textarea fxFlex class="tcs-collaboration-input" [(ngModel)]="newNote.text" name="newNote.text" md-maxlength="10000" placeholder="New Thread... " rows="2" max-rows="true"></textarea>
      </form>
      <mat-icon class="tcs-icon tcs-collaboration-send-icon" svgIcon="tcs-collaboration-send" (click)="createThread(newNote.text)"></mat-icon>
    </div>
  </div>
</div>

<!--mat-list fxLayout="column" *ngIf="threads && threads.threads.length > 0">
  <div *ngFor="let thread of threads.threads" fxLayout="column">
    <h4 matSubheader>{{thread.note.createdByName}}</h4>
    <mat-list-item>
      <h4 mat-line>{{thread.note.text}}</h4>
      <p mat-line> {{thread.note.modifiedDate | date}} </p>
    </mat-list-item>
    <mat-divider></mat-divider>
    <div *ngIf="thread.thread.length > 0" style="margin-left: 50px;">
      <h4 matSubheader>Replies</h4>
      <div>
        <mat-list-item *ngFor="let reply of thread.thread">
          <h4 mat-line>{{reply.createdByName}}</h4>
          <h4 mat-line>{{reply.text}}</h4>
          <p mat-line> {{reply.modifiedDate | date}} </p>
        </mat-list-item>
        <mat-divider></mat-divider>
      </div>
    </div>
  </div>
</mat-list>
</div-->


<!--
<h3>New Note:</h3>
<form #newNotesForm="ngForm" (submit)="createNote($event)" fxFlex fxLayout="column">
  <mat-form-field fxFlex>
    <input matInput name="newNote.text" type="text" placeholder="Comments" [(ngModel)]="newNote.text"/>
  </mat-form-field>
  <button mat-raised-button style="max-width: 100px" type="submit">Create Note</button>
</form>

<h3>Delete Note:</h3>
<form #delNotesForm="ngForm" (submit)="deleteNote($event)" fxFlex fxLayout="column">
  <mat-form-field fxFlex>
    <input matInput name="delNoteId" type="number" placeholder="Id" [(ngModel)]="delNoteId"/>
  </mat-form-field>
  <button mat-raised-button style="max-width: 100px" type="submit">Delete Note</button>
</form>

<br>

<div *ngFor="let note of notes">
    <pre>{{note | json}}</pre>
    <form #{{note.id}}updNotesForm="ngForm" (submit)="updateNote(note)" fxFlex fxLayout="column">
      <mat-form-field fxFlex>
        <input matInput name="note.text" type="text" placeholder="note text" [(ngModel)]="note.text"/>
      </mat-form-field>
    <button mat-raised-button style="max-width: 100px" type="submit">Update Note</button>
  </form>
</div>
-->
